<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Peform a differential expression analysis. — fdge • FacileAnalysis</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Peform a differential expression analysis. — fdge" />
<meta property="og:description" content="Use flm_def() to define the design matrix and contrast to test and
pass the FacileLinearModelDefinition object returned from that to fdge()
to run the desired differential testing framework (dictated by the method
parameter) over the data. flm_def accepts a" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FacileAnalysis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.98.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/FacileAnalysis-RNAseq.html">RNA-seq Analysis: The Facile Way</a>
    </li>
    <li>
      <a href="../articles/FacileAnalysis-examples.html">Reproducing genomic anlayses the facile way</a>
    </li>
    <li>
      <a href="../articles/FacileAnalysis-fdge.html">Facile Differential Expression Analysis</a>
    </li>
    <li>
      <a href="../articles/FacileAnalysis-fpca.html">Facile Principal Components Analysis</a>
    </li>
    <li>
      <a href="../articles/FacileAnalysis-fsea.html">Facile (Gene) Set Expression Analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/facilebio/FacileAnalysis/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Peform a differential expression analysis.</h1>
    <small class="dont-index">Source: <a href='https://github.com/facilebio/FacileAnalysis/blob/master/R/fdge.R'><code>R/fdge.R</code></a>, <a href='https://github.com/facilebio/FacileAnalysis/blob/master/R/fdge-compare.R'><code>R/fdge-compare.R</code></a>, <a href='https://github.com/facilebio/FacileAnalysis/blob/master/R/fdge-interact.R'><code>R/fdge-interact.R</code></a>, and 1 more</small>
    <div class="hidden name"><code>fdge.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Use <code><a href='flm_def.html'>flm_def()</a></code> to define the design matrix and contrast to test and
pass the <code>FacileLinearModelDefinition</code> object returned from that to <code>fdge()</code>
to run the desired differential testing framework (dictated by the <code>method</code>
parameter) over the data. <code>flm_def</code> accepts a</p>
    </div>

    <pre class="usage"><span class='fu'>fdge</span><span class='op'>(</span>
  <span class='va'>x</span>,
  assay_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='cn'>NULL</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  filter <span class='op'>=</span> <span class='st'>"default"</span>,
  with_sample_weights <span class='op'>=</span> <span class='cn'>FALSE</span>,
  treat_lfc <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileAnovaModelDefinition</span>
<span class='fu'>fdge</span><span class='op'>(</span>
  <span class='va'>x</span>,
  assay_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='cn'>NULL</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  filter <span class='op'>=</span> <span class='st'>"default"</span>,
  with_sample_weights <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileTtestDGEModelDefinition</span>
<span class='fu'>fdge</span><span class='op'>(</span>
  <span class='va'>x</span>,
  assay_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='cn'>NULL</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  filter <span class='op'>=</span> <span class='st'>"default"</span>,
  with_sample_weights <span class='op'>=</span> <span class='cn'>FALSE</span>,
  treat_lfc <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileLinearModelDefinition</span>
<span class='fu'>fdge</span><span class='op'>(</span>
  <span class='va'>x</span>,
  assay_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='cn'>NULL</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  filter <span class='op'>=</span> <span class='st'>"default"</span>,
  with_sample_weights <span class='op'>=</span> <span class='cn'>FALSE</span>,
  treat_lfc <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  with_box <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>,
  trend.eBayes <span class='op'>=</span> <span class='cn'>FALSE</span>,
  robust.eBayes <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileTtestAnalysisResult</span>
<span class='fu'><a href='compare.html'>compare</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, treat_lfc <span class='op'>=</span> <span class='fu'><a href='param.html'>param</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"treat_lfc"</span><span class='op'>)</span>, rerun <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for FacileTtestComparisonAnalysisResult</span>
<span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span>
  <span class='va'>x</span>,
  max_padj <span class='op'>=</span> <span class='fl'>0.1</span>,
  min_logFC <span class='op'>=</span> <span class='cn'>NULL</span>,
  labels <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  max_padj_x <span class='op'>=</span> <span class='va'>max_padj</span>,
  max_padj_y <span class='op'>=</span> <span class='va'>max_padj</span>,
  min_logFC_x <span class='op'>=</span> <span class='va'>min_logFC</span>,
  min_logFC_y <span class='op'>=</span> <span class='va'>min_logFC</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileTtestAnalysisResult</span>
<span class='fu'><a href='viz.html'>report</a></span><span class='op'>(</span>
  <span class='va'>x</span>,
  type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"dge"</span>, <span class='st'>"features"</span><span class='op'>)</span>,
  ntop <span class='op'>=</span> <span class='fl'>200</span>,
  max_padj <span class='op'>=</span> <span class='fl'>0.1</span>,
  min_logFC <span class='op'>=</span> <span class='fl'>1</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  highlight <span class='op'>=</span> <span class='cn'>NULL</span>,
  round_digits <span class='op'>=</span> <span class='fl'>3</span>,
  event_source <span class='op'>=</span> <span class='st'>"A"</span>,
  webgl <span class='op'>=</span> <span class='cn'>TRUE</span>,
  caption <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for FacileTtestComparisonAnalysisResult</span>
<span class='fu'><a href='ffsea.html'>ffsea</a></span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>fsets</span>,
  methods <span class='op'>=</span> <span class='cn'>NULL</span>,
  type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"interaction"</span>, <span class='st'>"quadrants"</span><span class='op'>)</span>,
  features <span class='op'>=</span> <span class='cn'>NULL</span>,
  min_logFC <span class='op'>=</span> <span class='fu'><a href='param.html'>param</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"treat_lfc"</span><span class='op'>)</span>,
  max_padj <span class='op'>=</span> <span class='fl'>0.1</span>,
  rank_by <span class='op'>=</span> <span class='st'>"logFC"</span>,
  signed <span class='op'>=</span> <span class='cn'>TRUE</span>,
  biased_by <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  rank_order <span class='op'>=</span> <span class='st'>"ranked"</span>,
  group_by <span class='op'>=</span> <span class='st'>"direction"</span>,
  select_by <span class='op'>=</span> <span class='st'>"significant"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a data source</p></td>
    </tr>
    <tr>
      <th>assay_name</th>
      <td><p>the name of the assay that holds the measurements for test.
Defaults to <code>default_assay(x)</code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The differential testing framework to use over the data. The
valid choices are defined by the type of assay <code>assay_name</code>is. Refer to the
<em>Differential Expression Testing Methods</em> section for more details.</p></td>
    </tr>
    <tr>
      <th>features</th>
      <td><p>Explicitly request the features to test. If this is provided,
then the <code>filter</code> criteria (to remove low abundance features, for instance)
is skipped. By default this is <code>NULL</code></p></td>
    </tr>
    <tr>
      <th>filter, with_sample_weights</th>
      <td><p>Passed into <code><a href='https://rdrr.io/pkg/FacileData/man/biocbox.html'>biocbox()</a></code> to determine which
features (genes) are removed from the dataset for testing, as well as if
to use <code><a href='https://rdrr.io/pkg/limma/man/arrayWeights.html'>limma::arrayWeights()</a></code> or <code><a href='https://rdrr.io/pkg/limma/man/voomWithQualityWeights.html'>limma::voomWithQualityWeights()</a></code>
(where appropriate) when testing (default is not to).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>passed down into inner methods, such as <code>biocbox</code> to tweak
filtering criteria, for instance</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>a <code>sample_id,feature_id,weight</code> table of observation weights
to use when <code>method == "limma"</code>.</p></td>
    </tr>
    <tr>
      <th>rerun</th>
      <td><p>When comparing two results, the features analyzed in each may
differ, making comparisons between the two objects sparse, at times.
When <code>rerun = TRUE</code> (default), the original linear models are rerun with
their features set to <code><a href='https://rdrr.io/r/base/sets.html'>union(features(x), features(y))</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="differential-expression-testing-methods"><a class="anchor" href="#differential-expression-testing-methods"></a>Differential Expression Testing Methods</h2>

    

<p>The appropriate statistical framework to use for differential expression
testing is defined by the type of data that is recorded in the assay
<code>assay_name</code>, ie. <code>assay_info(x, assay_name)$assay_type</code>.</p>
<p>The <code><a href='fdge_methods.html'>fdge_methods()</a></code> function returns a tibble of appropriate
<code>assay_type -&gt; dge_method</code> associations. The first entry for each
<code>dge_method</code> is the default <code>method</code> used if one isn't provided by the
caller.</p>
<p>The available methods are:</p><ul>
<li><p><code>"voom"</code>: For count data, uses <code><a href='https://rdrr.io/pkg/limma/man/voomWithQualityWeights.html'>limma::voomWithQualityWeights()</a></code> when
<code>with_sample_weights = TRUE</code>.</p></li>
<li><p><code>"edgeR-qlf"</code>: The edgeR quasi-likelihood method, for count data.</p></li>
<li><p><code>"limma-trend"</code>: Usable for log-transformed data that "looks like" it came
from count data, or where there is a "trend" of the variance with the
mean, uses  <code><a href='https://rdrr.io/pkg/limma/man/arrayWeights.html'>limma::arrayWeights()</a></code> when <code>with_sample_weights = TRUE</code>.</p></li>
<li><p><code>"limma"</code>: Straightup limma, this expects log2-normal like data, with
(largely) no trend of the variance to the mean worth modeling. Uses
<code><a href='https://rdrr.io/pkg/limma/man/arrayWeights.html'>limma::arrayWeights()</a></code> when <code>with_sample_weights = TRUE</code></p></li>
</ul>

    <h2 class="hasAnchor" id="feature-filtering-strategy"><a class="anchor" href="#feature-filtering-strategy"></a>Feature Filtering Strategy</h2>

    

<p>You will almost always want to filter out lowly abundant features before
performing differential expression analysis. You can either do this by
explicitly requesting which features to test via the <code>features</code> parameter,
or by setting <code>filter = "default</code>.</p>
<p>When <code>filter == "default"</code>, the filtering strategy is largely based on the
logic found in <code><a href='https://rdrr.io/pkg/edgeR/man/filterByExpr.html'>edgeR::filterByExpr()</a></code>.</p>
<p>When <code>fdge</code> analysis is performed on count data, the filtering is precisely
executed using this function, using <code><a href='design.html'>design(x)</a></code> as the design parameter to
<code>filterByExpr</code>. You can modify the filtering behavior by passing any
named parameters found in the <code><a href='https://rdrr.io/pkg/edgeR/man/filterByExpr.html'>edgeR::filterByExpr()</a></code> function down to it via
<code>fdge</code>'s <code>...</code> parameter (don't pass <code>design</code>, as this is already defined).</p>
<p>There are times when you want to tweak this behavior in ways that aren't
exactly supported by <code>filterByExpr</code>. You can pass in a "feature descriptor"
(a character vector of feature ids, or a data.frame with a "feature_id"
column) into the following parameters:</p><ul>
<li><p><code>filter_universe</code>: The features enumerated in this parameter will restrict
the universe of features that can potentially be included in the downstream
analysis. The <code>filterByExpr()</code> logic will happen downstream of this
universe. The default value is <code>NULL</code>, which specifies the universe of
features to be all of the ones measured using this assay.</p></li>
<li><p><code>filter_require</code>: The <code>filterByExpr</code> logic happens first on the universe
of features as parameterized. All features enumerated here will be forcibly
included in the analysis, irrespective of whether they would have passed
the perscribed filter criteria or not. The defalut value for this argument
is <code>NULL</code>, which means no genes are forcibly included in the analysis when
they do not pass muster given the filtering criteria.</p></li>
</ul>

    <h2 class="hasAnchor" id="comparing-dge-results-interaction-effect-"><a class="anchor" href="#comparing-dge-results-interaction-effect-"></a>Comparing DGE Results (interaction effect)</h2>

    

<p>It is often useful to compare the results of two t-tests, and for many
experimental designs, this can be a an intuitive way to perform test an
interaction effect.</p>
<p>The filtering strategy in the interaction model dictates that the union
of all features found in <code>x</code> are <code>y</code> are used in the test.</p>
    <h2 class="hasAnchor" id="statistics-tables"><a class="anchor" href="#statistics-tables"></a>Statistics Tables</h2>

    

<p>The stats table from the differential expression analysis can be retrieved
using the <code><a href='https://generics.r-lib.org/reference/tidy.html'>tidy()</a></code> function. Depending upon the type of analysis run, the
exact columns of the returned table may differ.</p>
<p><strong>Interaction Statistics</strong>
Calling <code><a href='https://generics.r-lib.org/reference/tidy.html'>tidy()</a></code> on an interaction test result
(<code>FacileTtestComparisonAnalysisResult</code>), returns the statistics for the
interaction test itself (if it was performed), as well as the statistics
for the individual DGE results that were run vai <code><a href='compare.html'>compare(x, y)</a></code> to get the
interaction results itself. The columns of statistics related to the
individual tests will be suffixed with <code>*.x</code> and <code>*.y</code>, respectively.</p>
<p>An <code>interaction_group</code> column will also be added to indicate what type of
statisticaly significance was found for each gene. The values in here can be:</p><ol>
<li><p><code>"both"</code>: this gene was statistically significant in both tests</p></li>
<li><p><code>"x"</code>: this gene was only significant in the <code>x</code> dge result</p></li>
<li><p><code>"y"</code>: this gene was only significant in the <code>y</code> dge result</p></li>
<li><p><code>"none"</code>: was not statistically significant in either test result</p></li>
</ol>

<p>The genes selected for significance from the input results <code>x</code> and <code>y</code> are
based on their <code>padj</code> and <code>logFC</code> values. The thresholds are tweaked by the
following parameters in the call to <code><a href='https://generics.r-lib.org/reference/tidy.html'>tidy(compare(x,y))</a></code>:</p><ol>
<li><p><code>max_padj_(x|y)</code>: if not specified, defaults to <code>0.10</code></p></li>
<li><p><code>min_logFC_(x|y)</code>: if not specified, we will take the value that was
used in the <code>treat_lfc</code> parameters to <code>x</code> and <code>y</code> if those tests were
run against a threshold, otherwise defaults to <code>1</code>.</p></li>
</ol>

    <h2 class="hasAnchor" id="interacting-with-results"><a class="anchor" href="#interacting-with-results"></a>Interacting with results</h2>

    


<p>The <code>report</code> function will create an htmlwidget which can be explored by
the analyst or dropped into an Rmarkdown report.</p>
<p><code><a href='viz.html'>report(result, "dge", max_padj = 0.05, min_logFC = 1)</a></code> will create a
side-by-side volcano and datatable for differential expression results.</p>
    <h2 class="hasAnchor" id="gene-set-enrichment-analysis"><a class="anchor" href="#gene-set-enrichment-analysis"></a>Gene Set Enrichment Analysis</h2>

    

<p>There are a few ways you may consider running a gene set analysis over an
interaction analysis.</p><ol>
<li><p>On the statistics of the interaction itself; or</p></li>
<li><p>On the statistics of the different "quadrants" the features are binned
into that are found in the <code>sigclass</code> columns of the
tidied result table, ie. <code>tidy.FacileTtestComparisonAnalysisResult()</code>; or</p></li>
<li><p>Both.</p></li>
</ol>

<p>Note that an analysis on (2) only lends itself to an overrepresentation
analysis, ie. <code>methods = "ora"</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>efds</span> <span class='op'>&lt;-</span> <span class='fu'>FacileData</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/FacileData/man/exampleFacileDataSet.html'>exampleFacileDataSet</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>samples</span> <span class='op'>&lt;-</span> <span class='va'>efds</span> <span class='op'>%&gt;%</span>
  <span class='fu'>FacileData</span><span class='fu'>::</span><span class='fu'>filter_samples</span><span class='op'>(</span><span class='va'>indication</span> <span class='op'>==</span> <span class='st'>"BLCA"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>something <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdef</span> <span class='op'>&lt;-</span> <span class='fu'><a href='flm_def.html'>flm_def</a></span><span class='op'>(</span><span class='va'>samples</span>, covariate <span class='op'>=</span> <span class='st'>"sample_type"</span>,
                numer <span class='op'>=</span> <span class='st'>"tumor"</span>, denom <span class='op'>=</span> <span class='st'>"normal"</span>,
                batch <span class='op'>=</span> <span class='st'>"sex"</span><span class='op'>)</span>
<span class='va'>dge</span> <span class='op'>&lt;-</span> <span class='fu'>fdge</span><span class='op'>(</span><span class='va'>mdef</span>, method <span class='op'>=</span> <span class='st'>"voom"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='viz.html'>viz</a></span><span class='op'>(</span><span class='va'>dge</span><span class='op'>)</span>
  <span class='fu'><a href='viz.html'>viz</a></span><span class='op'>(</span><span class='va'>dge</span>, <span class='st'>"146909"</span><span class='op'>)</span>
  <span class='fu'><a href='viz.html'>shine</a></span><span class='op'>(</span><span class='va'>dge</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>dge.stats</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>dge</span><span class='op'>)</span>
<span class='va'>dge.sig</span> <span class='op'>&lt;-</span> <span class='fu'><a href='signature.html'>signature</a></span><span class='op'>(</span><span class='va'>dge</span><span class='op'>)</span>

<span class='va'>stage.anova</span> <span class='op'>&lt;-</span> <span class='va'>samples</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='flm_def.html'>flm_def</a></span><span class='op'>(</span>covariate <span class='op'>=</span> <span class='st'>"stage"</span>, batch <span class='op'>=</span> <span class='st'>"sex"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>fdge</span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"voom"</span><span class='op'>)</span>
<span class='va'>anova.sig</span> <span class='op'>&lt;-</span> <span class='fu'><a href='signature.html'>signature</a></span><span class='op'>(</span><span class='va'>stage.anova</span><span class='op'>)</span>
<span class='co'># Comparing two T-test results ----------------------------------------------</span>
<span class='co'># Let's compare the tumor vs normal DGE results in CRC vs BLCA</span>

<span class='va'>efds</span> <span class='op'>&lt;-</span> <span class='fu'>FacileData</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/FacileData/man/exampleFacileDataSet.html'>exampleFacileDataSet</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>dge.crc</span> <span class='op'>&lt;-</span> <span class='fu'>FacileData</span><span class='fu'>::</span><span class='fu'>filter_samples</span><span class='op'>(</span><span class='va'>efds</span>, <span class='va'>indication</span> <span class='op'>==</span> <span class='st'>"CRC"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='flm_def.html'>flm_def</a></span><span class='op'>(</span><span class='st'>"sample_type"</span>, <span class='st'>"tumor"</span>, <span class='st'>"normal"</span>, <span class='st'>"sex"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>fdge</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>dge.blca</span> <span class='op'>&lt;-</span> <span class='fu'>FacileData</span><span class='fu'>::</span><span class='fu'>filter_samples</span><span class='op'>(</span><span class='va'>efds</span>, <span class='va'>indication</span> <span class='op'>==</span> <span class='st'>"BLCA"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='flm_def.html'>flm_def</a></span><span class='op'>(</span><span class='st'>"sample_type"</span>, <span class='st'>"tumor"</span>, <span class='st'>"normal"</span>, <span class='st'>"sex"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>fdge</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>dge.comp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='compare.html'>compare</a></span><span class='op'>(</span><span class='va'>dge.crc</span>, <span class='va'>dge.blca</span><span class='op'>)</span>
<span class='va'>comp.hi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>dge.comp</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>interaction_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Static visualization generates the main "4-way" plot, as well as the</span>
<span class='co'># facets for each category.</span>
<span class='va'>sviz</span> <span class='op'>&lt;-</span> <span class='fu'><a href='viz.html'>viz</a></span><span class='op'>(</span><span class='va'>dge.comp</span>, labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"CRC"</span>, y <span class='op'>=</span> <span class='st'>"BLCA"</span><span class='op'>)</span>,
            subtitle <span class='op'>=</span> <span class='st'>"Tumor vs normal comparisons across indications"</span>,
            highlight <span class='op'>=</span> <span class='va'>comp.hi</span><span class='op'>)</span>
<span class='co'># highlight some of them</span>
<span class='va'>s.hi</span> <span class='op'>&lt;-</span> <span class='va'>sviz</span><span class='op'>$</span><span class='va'>input_data</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>interaction_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"patchwork"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>patchwork</span><span class='fu'>::</span><span class='fu'><a href='https://patchwork.data-imaginist.com/reference/wrap_plots.html'>wrap_plots</a></span><span class='op'>(</span>
    <span class='va'>sviz</span><span class='op'>$</span><span class='va'>plot</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span>,
    <span class='va'>sviz</span><span class='op'>$</span><span class='va'>plot_facets</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>,
    nrow <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='fu'><a href='viz.html'>viz</a></span><span class='op'>(</span><span class='va'>dge.comp</span>, labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"CRC"</span>, y <span class='op'>=</span> <span class='st'>"BLCA"</span><span class='op'>)</span>,
      color_quadrant <span class='op'>=</span> <span class='st'>"darkgrey"</span><span class='op'>)</span><span class='op'>$</span><span class='va'>plot_facets</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required namespace: patchwork</span></div><div class='img'><img src='fdge-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Steve Lianoglou, Denali Therapeutics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


